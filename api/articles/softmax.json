{"title":"力扣题解：Softmax 算子定点化输出","uid":"c2179b34d4e2fd84ea26ff2b8443712f","slug":"softmax","date":"2025-06-27T16:00:00.000Z","updated":"2025-08-15T12:04:46.966Z","comments":true,"path":"api/articles/softmax.json","keywords":"blog, technology, programming","cover":"https://raw.githubusercontent.com/LingmaFuture/lingmafuture.github.io/refs/heads/main/images/2.png","content":"<h2 id=\"题目描述\"><a href=\"#题目描述\" class=\"headerlink\" title=\"题目描述\"></a>题目描述</h2><p>给定输入 $x_1, x_2, \\dots, x_n$，需要对它们做 Softmax 变换，定义：</p>\n<p>$$<br> y_i &#x3D; \\frac{\\exp(x_i)}{\\sum_{j&#x3D;1}^n \\exp(x_j)}<br>$$</p>\n<p>接着对 $y_i$ 执行以下定点化操作：</p>\n<ol>\n<li><strong>放大</strong>：乘以 256</li>\n<li><strong>四舍五入</strong>：定义 <code>round(z) = \\lfloor z + 0.5 \\rfloor</code></li>\n<li><strong>限幅</strong>：将结果限制到 $[0, 256]$ 范围内</li>\n<li><strong>输出</strong>：输出 n 行整数，每行一个定点化结果</li>\n</ol>\n<p><strong>输入格式</strong>：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">第一行：整数 n，表示输入向量长度</span><br><span class=\"line\">第二行：n 个实数 x1 x2 ... xn</span><br></pre></td></tr></table></figure>\n\n<p><strong>输出格式</strong>：</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">共 n 行，每行一个整数，即定点化后的 y_i</span><br></pre></td></tr></table></figure>\n\n<p><strong>示例</strong>:</p>\n<figure class=\"highlight text\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">输入：</span><br><span class=\"line\">2</span><br><span class=\"line\">0 0</span><br><span class=\"line\">输出：</span><br><span class=\"line\">128</span><br><span class=\"line\">128</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"解题思路\"><a href=\"#解题思路\" class=\"headerlink\" title=\"解题思路\"></a>解题思路</h2><ol>\n<li><p><strong>读取输入</strong></p>\n<ul>\n<li>读取整数 <code>n</code></li>\n<li>读取 <code>n</code> 个浮点数，保存到列表 <code>xs</code></li>\n</ul>\n</li>\n<li><p><strong>数值稳定化</strong></p>\n<ul>\n<li><p>Softmax 计算中直接对大数做 <code>exp</code> 可能导致溢出</p>\n</li>\n<li><p>常用技巧：令</p>\n<p>$$<br>  m &#x3D; \\max_i x_i, \\quad \\tilde x_i &#x3D; x_i - m<br>$$</p>\n</li>\n<li><p>此时 <code>exp(tilde_x_i)</code> 相对安全</p>\n</li>\n</ul>\n</li>\n<li><p><strong>计算指数与分母</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">exps = [math.exp(x - m) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> xs]</span><br><span class=\"line\">denom = <span class=\"built_in\">sum</span>(exps)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>计算 Softmax 概率并定点化</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">results = []</span><br><span class=\"line\"><span class=\"keyword\">for</span> e <span class=\"keyword\">in</span> exps:</span><br><span class=\"line\">    p = e / denom           <span class=\"comment\"># 软最大概率</span></span><br><span class=\"line\">    v = p * <span class=\"number\">256.0</span>           <span class=\"comment\"># 放大 256</span></span><br><span class=\"line\">    r = <span class=\"built_in\">int</span>(math.floor(v + <span class=\"number\">0.5</span>))  <span class=\"comment\"># 自定义四舍五入</span></span><br><span class=\"line\">    <span class=\"comment\"># 限幅至 [0,256]</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> r &lt; <span class=\"number\">0</span>:</span><br><span class=\"line\">        r = <span class=\"number\">0</span></span><br><span class=\"line\">    <span class=\"keyword\">elif</span> r &gt; <span class=\"number\">256</span>:</span><br><span class=\"line\">        r = <span class=\"number\">256</span></span><br><span class=\"line\">    results.append(r)</span><br></pre></td></tr></table></figure>\n</li>\n<li><p><strong>输出结果</strong></p>\n<figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">print</span>(<span class=\"string\">&quot;\\n&quot;</span>.join(<span class=\"built_in\">str</span>(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> results))</span><br></pre></td></tr></table></figure></li>\n</ol>\n<hr>\n<h2 id=\"完整代码（Python）\"><a href=\"#完整代码（Python）\" class=\"headerlink\" title=\"完整代码（Python）\"></a>完整代码（Python）</h2><figure class=\"highlight python\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> sys</span><br><span class=\"line\"><span class=\"keyword\">import</span> math</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">def</span> <span class=\"title function_\">func</span>():</span><br><span class=\"line\">    data = sys.stdin.read().strip().split()</span><br><span class=\"line\">    n = <span class=\"built_in\">int</span>(data[<span class=\"number\">0</span>])</span><br><span class=\"line\">    xs = <span class=\"built_in\">list</span>(<span class=\"built_in\">map</span>(<span class=\"built_in\">float</span>, data[<span class=\"number\">1</span>:<span class=\"number\">1</span>+n]))</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 1. 稳定化处理</span></span><br><span class=\"line\">    m = <span class=\"built_in\">max</span>(xs)</span><br><span class=\"line\">    exps = [math.exp(x - m) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> xs]</span><br><span class=\"line\">    denom = <span class=\"built_in\">sum</span>(exps)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 2. Softmax → 放大 → 四舍五入 → 限幅</span></span><br><span class=\"line\">    results = []</span><br><span class=\"line\">    <span class=\"keyword\">for</span> e <span class=\"keyword\">in</span> exps:</span><br><span class=\"line\">        p = e / denom</span><br><span class=\"line\">        v = p * <span class=\"number\">256.0</span></span><br><span class=\"line\">        r = <span class=\"built_in\">int</span>(math.floor(v + <span class=\"number\">0.5</span>))</span><br><span class=\"line\">        r = <span class=\"built_in\">max</span>(<span class=\"number\">0</span>, <span class=\"built_in\">min</span>(r, <span class=\"number\">256</span>))</span><br><span class=\"line\">        results.append(r)</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\"># 3. 输出</span></span><br><span class=\"line\">    sys.stdout.write(<span class=\"string\">&quot;\\n&quot;</span>.join(<span class=\"built_in\">str</span>(x) <span class=\"keyword\">for</span> x <span class=\"keyword\">in</span> results))</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">if</span> __name__ == <span class=\"string\">&#x27;__main__&#x27;</span>:</span><br><span class=\"line\">    func()</span><br></pre></td></tr></table></figure>\n\n<hr>\n<h2 id=\"复杂度分析\"><a href=\"#复杂度分析\" class=\"headerlink\" title=\"复杂度分析\"></a>复杂度分析</h2><ul>\n<li><p><strong>时间复杂度</strong>：</p>\n<ul>\n<li>读取、减值、求指数、求和、循环遍历，均为 $O(n)$</li>\n<li>适用于 $n$ 最大在 $10^5$ 量级</li>\n</ul>\n</li>\n<li><p><strong>空间复杂度</strong>：</p>\n<ul>\n<li>存储输入数组和中间结果，均为 $O(n)$</li>\n</ul>\n</li>\n</ul>\n<hr>\n","feature":true,"text":"完整的题目整理和详尽解题思路，包含数值稳定化、定点化细节、示例及代码实现。...","permalink":"/post/softmax","photos":[],"count_time":{"symbolsCount":"1.6k","symbolsTime":"1 mins."},"categories":[{"name":"Algorithm","slug":"Algorithm","count":2,"path":"api/categories/Algorithm.json"}],"tags":[{"name":"code","slug":"code","count":2,"path":"api/tags/code.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E9%A2%98%E7%9B%AE%E6%8F%8F%E8%BF%B0\"><span class=\"toc-text\">题目描述</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%A7%A3%E9%A2%98%E6%80%9D%E8%B7%AF\"><span class=\"toc-text\">解题思路</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%AE%8C%E6%95%B4%E4%BB%A3%E7%A0%81%EF%BC%88Python%EF%BC%89\"><span class=\"toc-text\">完整代码（Python）</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E5%A4%8D%E6%9D%82%E5%BA%A6%E5%88%86%E6%9E%90\"><span class=\"toc-text\">复杂度分析</span></a></li></ol>","author":{"name":"Rockway","slug":"blog-author","avatar":"https://lingmafuture.github.io/images/3.jpg","link":"https://lingmafuture.github.io","description":"欢迎交流机器学习、深度学习、计算机视觉、自然语言处理等技术！","socials":{"github":"https://github.com/lingmafuture","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"mapped":true,"hidden":false,"prev_post":{"title":"信仰产品之前，先信仰世界","uid":"902841660a63024fb4af3ed99735d7aa","slug":"doit","date":"2025-06-30T16:00:00.000Z","updated":"2025-08-15T11:57:25.051Z","comments":true,"path":"api/articles/doit.json","keywords":"blog, technology, programming","cover":"https://raw.githubusercontent.com/LingmaFuture/lingmafuture.github.io/refs/heads/main/images/3.png","text":" “只要理论上可行，那它就一定可以实现。”——张一鸣“在一切真正开始之前，没有人相信那真的会发生。”——《三体》 当我们站在某个创意的门口，望着脑海中那个未曾落...","permalink":"/post/doit","photos":[],"count_time":{"symbolsCount":"1.3k","symbolsTime":"1 mins."},"categories":[{"name":"Notes","slug":"Notes","count":2,"path":"api/categories/Notes.json"}],"tags":[{"name":"think","slug":"think","count":1,"path":"api/tags/think.json"}],"author":{"name":"Rockway","slug":"blog-author","avatar":"https://lingmafuture.github.io/images/3.jpg","link":"https://lingmafuture.github.io","description":"欢迎交流机器学习、深度学习、计算机视觉、自然语言处理等技术！","socials":{"github":"https://github.com/lingmafuture","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true},"next_post":{"title":"新的开始：Rockway 的数字足迹","uid":"4ce52b854d96c967a704cd97b3902d05","slug":"new-begin","date":"2025-06-26T16:00:00.000Z","updated":"2025-08-15T11:57:42.265Z","comments":true,"path":"api/articles/new-begin.json","keywords":"blog, technology, programming","cover":"https://raw.githubusercontent.com/LingmaFuture/lingmafuture.github.io/refs/heads/main/images/1.png","text":"大家好！欢迎来到我的个人博客。能够在这片属于自己的小小天地里与你相遇，我感到无比激动。未来的日子里，希望这里能成为我们共同交流、成长与启发灵感的空间。 1. 自...","permalink":"/post/new-begin","photos":[],"count_time":{"symbolsCount":883,"symbolsTime":"1 mins."},"categories":[{"name":"Notes","slug":"Notes","count":2,"path":"api/categories/Notes.json"}],"tags":[{"name":"welcome","slug":"welcome","count":1,"path":"api/tags/welcome.json"}],"author":{"name":"Rockway","slug":"blog-author","avatar":"https://lingmafuture.github.io/images/3.jpg","link":"https://lingmafuture.github.io","description":"欢迎交流机器学习、深度学习、计算机视觉、自然语言处理等技术！","socials":{"github":"https://github.com/lingmafuture","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{}}},"feature":true}}